<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gerko Vink, Thom Volker and Erik-Jan van Kesteren">

<title>Exercise C</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Practical_C_files/libs/clipboard/clipboard.min.js"></script>
<script src="Practical_C_files/libs/quarto-html/quarto.js"></script>
<script src="Practical_C_files/libs/quarto-html/popper.min.js"></script>
<script src="Practical_C_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Practical_C_files/libs/quarto-html/anchor.min.js"></script>
<link href="Practical_C_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Practical_C_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Practical_C_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Practical_C_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Practical_C_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#default-dataset-from-package-islr" id="toc-default-dataset-from-package-islr" class="nav-link" data-scroll-target="#default-dataset-from-package-islr">Default dataset from package <code>ISLR</code></a></li>
  <li><a href="#k-nearest-neighbours" id="toc-k-nearest-neighbours" class="nav-link" data-scroll-target="#k-nearest-neighbours">K-Nearest Neighbours</a></li>
  <li><a href="#confusion-matrix" id="toc-confusion-matrix" class="nav-link" data-scroll-target="#confusion-matrix">Confusion matrix</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">Logistic regression</a>
  <ul class="collapse">
  <li><a href="#visualising-the-effect-of-the-balance-variable" id="toc-visualising-the-effect-of-the-balance-variable" class="nav-link" data-scroll-target="#visualising-the-effect-of-the-balance-variable">Visualising the effect of the balance variable</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exercise C</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gerko Vink, Thom Volker and Erik-Jan van Kesteren </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<hr>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<hr>
<p>In this practical, we will focus on two different classification methods: K-nearest neighbours and logistic regression.</p>
<p>One of the packages we are going to use is <code>class</code>. For this, you will probably need to <code>install.packages("class")</code> before running the <code>library()</code> functions. <code>ISLR</code> is also a new package, that needs to be installed to access the <code>Default</code> data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(class)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISLR)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Before starting with the exercises, it is a good idea to set your seed, so that (1) your answers are reproducible and (2) you can compare your answers with the answers provided.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">45</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="default-dataset-from-package-islr" class="level1">
<h1>Default dataset from package <code>ISLR</code></h1>
<hr>
<p>The default dataset contains credit card loan data for 10 000 people. The goal is to classify credit card cases as <code>yes</code> or <code>no</code> based on whether they will default on their loan.</p>
<hr>
<ol type="1">
<li><strong>Create a scatterplot of the <code>Default</code> dataset, where <code>balance</code> is mapped to the x position, <code>income</code> is mapped to the y position, and <code>default</code> is mapped to the colour. Can you see any interesting patterns already?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ISLR<span class="sc">::</span>Default <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(default) <span class="sc">%&gt;%</span> <span class="co"># so the yellow dots are plotted after the blue ones</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income, <span class="at">colour =</span> default)) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="co"># optional custom colour scale</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/defaultplot1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It is clear that people with a larger remaining balance are more likely to default. When you look carefully, you may be able to identify two clusters in the data. One cluster for lower incomes and one cluster for higher incomes. The probability to default follows the same pattern in both clusters: higher remaining balance means an increase in probability to default.</p>
<hr>
<ol start="2" type="1">
<li><strong>Add the line <code>+ facet_grid(cols = vars(student))</code> to the plot. What do you see?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Default <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(default) <span class="sc">%&gt;%</span> <span class="co"># so the yellow dots are plotted after the blue ones</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income, <span class="at">colour =</span> default)) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="at">cols =</span> <span class="fu">vars</span>(student))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/defaultplot2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Clearly, if we facet the plot over students and non-students, we see that the lower income group is well-represented by the students.</p>
<hr>
<ol start="3" type="1">
<li><strong>Transform “student” into a dummy variable using <code>ifelse()</code> (0 = not a student, 1 = student). Then, randomly split the Default dataset into a training set <code>train</code> (80%) and a test set <code>test</code> (20%).</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create train/test split</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(Default<span class="sc">$</span>default, <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>Default <span class="sc">%&lt;&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">student =</span> <span class="fu">ifelse</span>(student <span class="sc">==</span> <span class="st">"Yes"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> Default[trainIndex, ]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> Default[<span class="sc">-</span>trainIndex, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="k-nearest-neighbours" class="level1">
<h1>K-Nearest Neighbours</h1>
<hr>
<p>Now that we have explored the dataset, we can start on the task of classification. We can imagine a credit card company wanting to predict whether a customer will default on the loan so they can take steps to prevent this from happening.</p>
<p>The first method we will be using is k-nearest neighbours (KNN). It classifies datapoints based on a majority vote of the k points closest to it. In <code>R</code>, the <code>class</code> package contains a <code>knn()</code> function to perform knn.</p>
<hr>
<ol start="4" type="1">
<li><strong>Create class predictions for the test set using the <code>knn()</code> function. Use <code>student</code>, <code>balance</code>, and <code>income</code> (but no basis functions of those variables) in the <code>train</code> dataset. Set <code>k</code> to 5. Store the predictions in a variable called <code>knn_5_pred</code>.</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>knn_5_pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default),</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">test  =</span> test  <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl    =</span> <span class="fu">as_factor</span>(train<span class="sc">$</span>default),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">k     =</span> <span class="dv">5</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>knn_5_pred</code> object contains the predictions for the <code>test</code> data column <code>default</code>. These predictions are obtained by applying the <code>knn()</code> function on the <code>train</code> set. To be able to generate predictions, the <code>knn()</code> has been given the true classes/values (<code>cl</code>) from the training data set. The <code>knn()</code> function has not seen the true classes for the `test set.</p>
<hr>
<ol start="5" type="1">
<li><strong>Create two scatter plots with income and balance as in the first plot you made. One with the true class (<code>default</code>) mapped to the colour aesthetic, and one with the predicted class (<code>knn_5_pred</code>) mapped to the colour aesthetic.</strong></li>
</ol>
<p><em>Hint: Add the predicted class <code>knn_5_pred</code> to the <code>test</code> dataset before starting your <code>ggplot()</code> call of the second plot. What do you see?</em></p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first plot is the same as before</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>test <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(default) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income, <span class="at">colour =</span> default)) <span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"True class"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/plotknn-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># second plot maps pred to colour</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(test, <span class="at">default_pred =</span> knn_5_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(default) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income, <span class="at">colour =</span> default_pred)) <span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted class (5nn)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/plotknn-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From these plots it is clear that there are quite some misclassifications. Many <code>No</code> predictions with <code>Yes</code> as true values, and vice versa.</p>
<hr>
<ol start="6" type="1">
<li><strong>Repeat the same steps, but now with a <code>knn_2_pred</code> vector generated from a 2-nearest neighbours algorithm. Are there any differences?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>knn_2_pred <span class="ot">&lt;-</span> <span class="fu">knn</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> train <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default),</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">test  =</span> test  <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>default),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl    =</span> train<span class="sc">$</span>default,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">k     =</span> <span class="dv">2</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat the second plot from the previous exercise on the new knn predictions</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(test, <span class="at">default_pred =</span> knn_2_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(default) <span class="sc">%&gt;%</span> </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> income, <span class="at">colour =</span> default_pred)) <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Predicted class (2nn)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/knn2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Compared to the KNN (K=5) model, more people get classified as <code>Yes</code>. Still, the KNN (K=2) model is far from perfect. t</p>
<hr>
</section>
<section id="confusion-matrix" class="level1">
<h1>Confusion matrix</h1>
<hr>
<p>The confusion matrix is an insightful summary of the plots we have made and the correct and incorrect classifications therein. A confusion matrix can be made in <code>R</code> with the <code>confusionMatrix()</code> function from the <code>caret</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(knn_2_pred, test<span class="sc">$</span>default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   No  Yes
       No  1885   46
       Yes   48   20
                                          
               Accuracy : 0.953           
                 95% CI : (0.9428, 0.9618)
    No Information Rate : 0.967           
    P-Value [Acc &gt; NIR] : 0.9996          
                                          
                  Kappa : 0.2742          
                                          
 Mcnemar's Test P-Value : 0.9179          
                                          
            Sensitivity : 0.9752          
            Specificity : 0.3030          
         Pos Pred Value : 0.9762          
         Neg Pred Value : 0.2941          
             Prevalence : 0.9670          
         Detection Rate : 0.9430          
   Detection Prevalence : 0.9660          
      Balanced Accuracy : 0.6391          
                                          
       'Positive' Class : No              
                                          </code></pre>
</div>
</div>
<hr>
<ol start="7" type="1">
<li><strong>What would this confusion matrix look like if the classification were perfect?</strong></li>
</ol>
<hr>
<p>If the classification would be perfect, the confusion matrix would be:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   No  Yes
       No  1933    0
       Yes    0   66
                                     
               Accuracy : 1          
                 95% CI : (0.9982, 1)
    No Information Rate : 0.967      
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16  
                                     
                  Kappa : 1          
                                     
 Mcnemar's Test P-Value : NA         
                                     
            Sensitivity : 1.000      
            Specificity : 1.000      
         Pos Pred Value : 1.000      
         Neg Pred Value : 1.000      
             Prevalence : 0.967      
         Detection Rate : 0.967      
   Detection Prevalence : 0.967      
      Balanced Accuracy : 1.000      
                                     
       'Positive' Class : No         
                                     </code></pre>
</div>
</div>
<hr>
<ol start="8" type="1">
<li><strong>Make a confusion matrix for the 5-nn model and compare it to that of the 2-nn model. What do you conclude?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(knn_5_pred, test<span class="sc">$</span>default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   No  Yes
       No  1919   52
       Yes   14   14
                                          
               Accuracy : 0.967           
                 95% CI : (0.9582, 0.9744)
    No Information Rate : 0.967           
    P-Value [Acc &gt; NIR] : 0.5327          
                                          
                  Kappa : 0.2838          
                                          
 Mcnemar's Test P-Value : 5.254e-06       
                                          
            Sensitivity : 0.9928          
            Specificity : 0.2121          
         Pos Pred Value : 0.9736          
         Neg Pred Value : 0.5000          
             Prevalence : 0.9670          
         Detection Rate : 0.9600          
   Detection Prevalence : 0.9860          
      Balanced Accuracy : 0.6024          
                                          
       'Positive' Class : No              
                                          </code></pre>
</div>
</div>
<p>The KNN (K=2) model has more true positives (<code>yes</code>-<code>yes</code>) but also more false positives (truly <code>No</code> in the Reference but predicted <code>Yes</code>). Overall the KNN (K=5) model has slightly better accuracy (proportion of correct classifications). However, although this accuracy is higher than if we would randomly assign <code>Yes</code> or <code>No</code> to cases, the performance of the model is identical to the performance when we would hava classified all values as <code>No</code>.</p>
<hr>
</section>
<section id="logistic-regression" class="level1">
<h1>Logistic regression</h1>
<hr>
<p>KNN directly predicts the class of a new observation using a majority vote of the existing observations closest to it. In contrast to this, logistic regression predicts the <code>log-odds</code> of belonging to category 1. These log-odds can then be transformed to probabilities by performing an inverse logit transform:</p>
<p><span class="math display">\[ p = \frac{1}{1+e^{-\alpha}}\]</span>, where <span class="math inline">\(\alpha\)</span> indicates log-odds for being in class 1 and <span class="math inline">\(p\)</span> is the probability.</p>
<p>Therefore, logistic regression is a <code>probabilistic</code> classifier as opposed to a <code>direct</code> classifier such as KNN: indirectly, it outputs a probability which can then be used in conjunction with a cutoff (usually 0.5) to classify new observations.</p>
<p>Logistic regression in <code>R</code> happens with the <code>glm()</code> function, which stands for generalized linear model. Here we have to indicate that the residuals are modeled not as a gaussian (normal distribution), but as a <code>binomial</code> distribution.</p>
<hr>
<ol start="9" type="1">
<li><strong>Use <code>glm()</code> with argument <code>family = binomial</code> to fit a logistic regression model <code>fit</code> to the <code>train</code> data.</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(default <span class="sc">~</span> ., <span class="at">family =</span> binomial, <span class="at">data =</span> train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have generated a model, we can use the <code>predict()</code> method to output the estimated probabilities for each point in the training dataset. By default <code>predict</code> outputs the log-odds, but we can transform it back using the inverse logit function of before or setting the argument <code>type = "response"</code> within the predict function.</p>
<hr>
<ol start="10" type="1">
<li><strong>Visualise the predicted probabilities versus observed class for the training dataset in <code>fit</code>. You can choose for yourself which type of visualisation you would like to make. Write down your interpretations along with your plot.</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">observed  =</span> train<span class="sc">$</span>default, </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">predicted =</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"response"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted, <span class="at">x =</span> observed, <span class="at">colour =</span> observed)) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>), <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dark blue"</span>, <span class="st">"orange"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Predicted probability to default"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/visdif-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This plot shows the predicted probabilities (obtained with <code>predict(fit, type = "response")</code>) for all the points in the <code>test</code> set. We can see that the defaulting (<code>Yes</code>) category has a higher average probability for a default compared to the <code>No</code> category, but there are still data points in the <code>No</code> category with high predicted probability for defaulting.</p>
<p>One advantage of parametric procedures like logistic regression is that we get parameters (coefficients) we can interpret.</p>
<hr>
<ol start="11" type="1">
<li><strong>Look at the coefficients of the <code>fit</code> model and interpret the coefficient for <code>balance</code>. What would the probability of default be for a person who is not a student, has an income of 40000, and a balance of 3000 dollars at the end of each month? Is this what you expect based on the plots we’ve made before?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>coefs[<span class="st">"balance"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    balance 
0.005728527 </code></pre>
</div>
</div>
<p>The higher the <code>balance</code>, the higher the log-odds of defaulting. To be more precise: each dollar increase in <code>balance</code> increases the log-odds of defaulting by 0.0057 Let’s study all coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>coefs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)       student       balance        income 
-1.063443e+01 -7.718385e-01  5.728527e-03 -1.168747e-06 </code></pre>
</div>
</div>
<p>Now, if we would like to calculate the predicted logodds of default for a person who is not a student (0 times the coefficient for <code>student</code>), has an income of 40000 (40000 multiplied with the coefficient for <code>income</code>) and a balance of 3000 dollars (3000 multiplied with the coefficient for <code>balance</code>), we can do the following to calculate the logodds directly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>logodds <span class="ot">&lt;-</span> coefs[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">0</span><span class="sc">*</span>coefs[<span class="dv">2</span>] <span class="sc">+</span> <span class="dv">40000</span><span class="sc">*</span>coefs[<span class="dv">4</span>] <span class="sc">+</span> <span class="dv">3000</span><span class="sc">*</span>coefs[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then convert the logodds to a probability by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>logodds))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  0.9985054 </code></pre>
</div>
</div>
<p>or as</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plogis</span>(logodds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
  0.9985054 </code></pre>
</div>
</div>
<p>There is a probability of .999 of defaulting. This is in line with the plots we have seen before. this new data point would be all the way to the right.</p>
<hr>
<section id="visualising-the-effect-of-the-balance-variable" class="level2">
<h2 class="anchored" data-anchor-id="visualising-the-effect-of-the-balance-variable">Visualising the effect of the balance variable</h2>
<p>In two steps, we will visualise the effect <code>balance</code> has on the predicted default probability.</p>
<hr>
<ol start="12" type="1">
<li><strong>Create a data frame called <code>balance_df</code> with 3 columns and 500 rows: <code>student</code> always 0, <code>balance</code> ranging from 0 to 3000, and <code>income</code> always the mean income in the <code>train</code> dataset.</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>balance_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">500</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">balance =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">3000</span>, <span class="at">length.out =</span> <span class="dv">500</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">income  =</span> <span class="fu">rep</span>(<span class="fu">mean</span>(train<span class="sc">$</span>income), <span class="dv">500</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<ol start="13" type="1">
<li><strong>Use this dataset as the <code>newdata</code> in a <code>predict()</code> call using <code>fit</code> to output the predicted probabilities for different values of <code>balance</code>. Then create a plot with the <code>balance_df$balance</code> variable mapped to x and the predicted probabilities mapped to y. Is this in line with what you expect?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>balance_df<span class="sc">$</span>predprob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">newdata =</span> balance_df, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>balance_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> balance, <span class="at">y =</span> predprob)) <span class="sc">+</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">col =</span> <span class="st">"dark blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="Practical_C_files/figure-html/marplot-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Just before a <code>balance</code> of 2000 dollars in the first plot is where the ratio of defaults vs non-defaults is 50/50. This line is exactly what we would expect.</p>
<hr>
<ol start="14" type="1">
<li><strong>Create a confusion matrix just as the one for the KNN models by using a cutoff predicted probability of 0.5. Does logistic regression perform better?</strong></li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, <span class="at">newdata =</span> test, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pred_lr   <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_prob <span class="sc">&gt;</span> .<span class="dv">5</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">confusionMatrix</span>(pred_lr, test<span class="sc">$</span>default)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   No  Yes
       No  1923   47
       Yes   10   19
                                          
               Accuracy : 0.9715          
                 95% CI : (0.9632, 0.9783)
    No Information Rate : 0.967           
    P-Value [Acc &gt; NIR] : 0.1429          
                                          
                  Kappa : 0.3877          
                                          
 Mcnemar's Test P-Value : 1.858e-06       
                                          
            Sensitivity : 0.9948          
            Specificity : 0.2879          
         Pos Pred Value : 0.9761          
         Neg Pred Value : 0.6552          
             Prevalence : 0.9670          
         Detection Rate : 0.9620          
   Detection Prevalence : 0.9855          
      Balanced Accuracy : 0.6414          
                                          
       'Positive' Class : No              
                                          </code></pre>
</div>
</div>
<p>Logistic regression performs better than KNN in every way - at least for our model on this data. Remember that we started with a random seed. Every procedure that uses random numbers thereafter has become seed dependent. This also holds for the <code>train</code>/<code>test</code> split that we realized. A different random split can therefore yield different results. Cross-validation - which I excluded in this practical - can give you an indication of the variance of this difference.</p>
<hr>
<p>End of Practical</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>